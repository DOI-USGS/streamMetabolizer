<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates a closure that bundles data and helper functions into a single
function that returns dDOdt in gO2 m^-3 timestep^-1 for any given time t."><title>Create a function that generates a 1-day timeseries of DO.mod — create_calc_dDOdt • streamMetabolizer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a function that generates a 1-day timeseries of DO.mod — create_calc_dDOdt"><meta property="og:description" content="Creates a closure that bundles data and helper functions into a single
function that returns dDOdt in gO2 m^-3 timestep^-1 for any given time t."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">streamMetabolizer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_prep.html">Data Preparation</a>
    <a class="dropdown-item" href="../articles/get_started.html">Quickstart</a>
    <a class="dropdown-item" href="../articles/gpp_er_eqs.html">GPP and ER Equations</a>
    <a class="dropdown-item" href="../articles/installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/model_structures.html">Model Structures</a>
    <a class="dropdown-item" href="../articles/models_bayes.html">Bayesian Models</a>
    <a class="dropdown-item" href="../articles/models_mle.html">MLE Models</a>
    <a class="dropdown-item" href="../articles/ode_methods.html">ODE Methods</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USGS-R/streamMetabolizer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create a function that generates a 1-day timeseries of DO.mod</h1>
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/streamMetabolizer/blob/HEAD/R/create_calc_dDOdt.R" class="external-link"><code>R/create_calc_dDOdt.R</code></a></small>
      <div class="d-none name"><code>create_calc_dDOdt.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a closure that bundles data and helper functions into a single
function that returns dDOdt in gO2 m^-3 timestep^-1 for any given time t.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, <span class="va">ode_method</span>, <span class="va">GPP_fun</span>, <span class="va">ER_fun</span>, <span class="va">deficit_src</span>, err.proc <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>data.frame as in <code><a href="metab.html">metab</a></code>, except that data must
contain exactly one date worth of inputs (~24 hours according to
<code><a href="specs.html">specs</a>$day_start</code> and <code><a href="specs.html">specs</a>$day_end</code>).</p></dd>


<dt>ode_method</dt>
<dd><p>character. The method to use in solving the ordinary
differential equation for DO. Options:</p><ul><li><p><code>euler</code>,
formerly <code>Euler</code>: the final change in DO from t=1 to t=2 is solely a
function of GPP, ER, DO, etc. at t=1</p></li>
<li><p><code>trapezoid</code>, formerly
<code>pairmeans</code>: the final change in DO from t=1 to t=2 is a function of
the mean values of GPP, ER, etc. across t=1 and t=2.</p></li>
<li><p>for
<code>type='mle'</code>, options also include <code>rk2</code> and any character method
accepted by <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></code> in the <code>deSolve</code> package
(<code>lsoda</code>, <code>lsode</code>, <code>lsodes</code>, <code>lsodar</code>, <code>vode</code>,
<code>daspk</code>, <code>rk4</code>, <code>ode23</code>, <code>ode45</code>, <code>radau</code>,
<code>bdf</code>, <code>bdf_d</code>, <code>adams</code>, <code>impAdams</code>, and
<code>impAdams_d</code>; note that many of these have not been well tested in the
context of <code>streamMetabolizer</code> models)</p></li>
</ul></dd>


<dt>GPP_fun</dt>
<dd><p>character. Function dictating how gross primary productivity
(GPP) varies within each day. Options:</p><ul><li><p><code>linlight</code>: GPP
is a linear function of light with an intercept at 0 and a slope that
varies by day. <br><code>GPP(t) = GPP.daily * light(t) / mean.light</code></p><ul><li><p><code>GPP.daily</code>: the daily mean GPP, which is partitioned
into timestep-specific rates according to the fraction of that day's
average light that occurs at each timestep (specifically, <code>mean.light</code>
is the mean of the first 24 hours of the date's data window)</p></li>
</ul></li>
<li><p><code>satlight</code>: GPP is a saturating function of light. <br><code>GPP(t) =
Pmax * tanh(alpha * light(t) / Pmax)</code></p><ul><li><p><code>Pmax</code>: the
maximum possible GPP</p></li>
<li><p><code>alpha</code>: a descriptor of the rate of
increase of GPP as a function of light</p></li>
</ul></li>
<li><p><code>satlightq10temp</code>: GPP
is a saturating function of light and an exponential function of
temperature. <br><code>GPP(t) = Pmax * tanh(alpha * light(t) / Pmax) *
1.036 ^ (temp.water(t) - 20)</code></p><ul><li><p><code>Pmax</code>: the maximum
possible GPP</p></li>
<li><p><code>alpha</code>: a descriptor of the rate of increase of
GPP as a function of light</p></li>
</ul></li>
<li><p><code>NA</code>: applicable only to
<code>type='Kmodel'</code>, for which GPP is not estimated</p></li>
</ul></dd>


<dt>ER_fun</dt>
<dd><p>character. Function dictating how ecosystem respiration (ER)
varies within each day. Options:</p><ul><li><p><code>constant</code>: ER is
constant over every timestep of the day. <br><code>ER(t) = ER.daily</code></p><ul><li><p><code>ER.daily</code>: the daily mean ER, which is equal to
instantaneous ER at all times</p></li>
</ul></li>
<li><p><code>q10temp</code>: ER at each timestep
is an exponential function of the water temperature and a
temperature-normalized base rate. <br><code>ER(t) = ER20 * 1.045 ^
(temp.water(t) - 20)</code></p><ul><li><p><code>ER20</code>: the value of ER when
<code>temp.water</code> is 20 degrees C</p></li>
</ul></li>
<li><p><code>NA</code>: applicable only to
<code>type='Kmodel'</code>, for which ER is not estimated</p></li>
</ul></dd>


<dt>deficit_src</dt>
<dd><p>character. From what DO estimate (observed or modeled)
should the DO deficit be computed? Options:</p><ul><li><p><code>DO_mod</code>:
the DO deficit at time t will be (DO.sat(t) - DO_mod(t)), the difference
between the equilibrium-saturation value and the current best estimate of
the true DO concentration at that time</p></li>
<li><p><code>DO_obs</code>: the DO deficit
at time t will be (DO.sat(t) - DO.obs(t)), the difference between the
equilibrium-saturation value and the measured DO concentration at that time</p></li>
<li><p><code>DO_obs_filter</code>: applicable only to <code>type='night'</code>: a
smoothing filter is applied over the measured DO.obs values before applying
nighttime regression</p></li>
<li><p><code>NA</code>: applicable only to
<code>type='Kmodel'</code>, for which DO deficit is not estimated</p></li>
</ul></dd>


<dt>err.proc</dt>
<dd><p>optional numerical vector of length nrow(data). Process error
in units of gO2 m^-2 d^-1 (THIS MAY DIFFER FROM WHAT YOU'RE USED TO!).
Appropriate for simulation, when this vector of process errors will be
added to the calculated values of GPP and ER (then divided by depth and
multiplied by timestep duration) to simulate process error. But usually
(for MLE or prediction from a fitted MLE/Bayesian/nighttime regression
model) <code>err.proc</code> should be missing or 0</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a function that accepts args <code>t</code> (the time in 0:(n-1) where n is
  the number of timesteps), <code>DO.mod.t</code> (the value of DO.mod at time t in
  gO2 m^-3), and <code>metab</code> (a list of metabolism parameters; to see which
  parameters should be included in this list, create <code>dDOdt</code> with this
  function and then call <code>environment(dDOdt)$metab.needs</code>)</p>
    </div>
    <div class="section level2">
    <h2 id="ode-method-trapezoid-">ode_method 'trapezoid'<a class="anchor" aria-label="anchor" href="#ode-method-trapezoid-"></a></h2>
    


<p>'pairmeans' and 'trapezoid' are identical. They are the analytical
solution to a trapezoid rule with this starting point:
<code>
 DO.mod[t+1] =
  DO.mod[t] +
   (((GPP[t]+GPP[t+1])/2) / (depth[t]+depth[t+1])/2
   + ((ER[t]+ER[t+1])/2) / (depth[t]+depth[t+1])/2
   + (k.O2[t](DO.sat[t] - DO.mod[t]) + k.O2[t+1](DO.sat[t+1] - DO.mod[t+1]))/2
   + ((err.proc[t]+err.proc[t+1])/2) / (depth[t]+depth[t+1])/2
   ) * timestep
</code>
and this solution:
<code>
DO.mod[t+1] - DO.mod[t] =
 (- DO.mod[t] * (k.O2[t]+k.O2[t+1])/2
   + (GPP[t]+GPP[t+1] +
      ER[t]+ER[t+1] +
      err.proc[t]+err.proc[t+1]
     ) / (depth[t]+depth[t+1])
   + (k.O2[t]*DO.sat[t] + k.O2[t+1]*DO.sat[t+1])/2
 ) * timestep / (1 + timestep*k.O2[t+1]/2)
</code>
where we're treating err.proc as a rate in gO2/m2/d, just like GPP &amp; ER, and
err.proc=0 for model fitting.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'30'</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">48</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">preds.init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="predict_metab.html">predict_metab</a></span><span class="op">(</span><span class="fu"><a href="metab.html">metab</a></span><span class="op">(</span><span class="fu"><a href="specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'mle'</span>, ode_method<span class="op">=</span><span class="st">'euler'</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  GPP.daily<span class="op">=</span><span class="va">GPP</span>, ER.daily<span class="op">=</span><span class="va">ER</span>, K600.daily<span class="op">=</span><span class="va">K600</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DOtime</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">solar.time</span></span></span>
<span class="r-in"><span><span class="va">dDOtime</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">solar.time</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">solar.time</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">data</span><span class="op">$</span><span class="va">solar.time</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># args to create_calc_dDOdt determine which values are needed in metab.pars</span></span></span>
<span class="r-in"><span><span class="va">dDOdt</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'trapezoid'</span>, GPP_fun<span class="op">=</span><span class="st">'satlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'q10temp'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">dDOdt</span><span class="op">)</span><span class="op">)</span> <span class="co"># always the same: args to pass to dDOdt()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">dDOdt</span><span class="op">)</span><span class="op">$</span><span class="va">metab.needs</span> <span class="co"># get the names to be included in metab.pars</span></span></span>
<span class="r-in"><span><span class="fu">dDOdt</span><span class="op">(</span>t<span class="op">=</span><span class="fl">23</span>, state<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  metab.pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Pmax<span class="op">=</span><span class="fl">0.2</span>, alpha<span class="op">=</span><span class="fl">0.01</span>, ER20<span class="op">=</span><span class="op">-</span><span class="fl">0.05</span>, K600.daily<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">dDOdt</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># different required args; try in a timeseries</span></span></span>
<span class="r-in"><span><span class="va">dDOdt</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'euler'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">dDOdt</span><span class="op">)</span><span class="op">$</span><span class="va">metab.needs</span> <span class="co"># get the names to be included in metab</span></span></span>
<span class="r-in"><span><span class="co"># approximate dDOdt and DO using DO.obs for DO deficits &amp; Eulerian integration</span></span></span>
<span class="r-in"><span><span class="va">DO.mod.m</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.mod.m</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="va">dDOdt.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">dDOdt</span><span class="op">(</span>t<span class="op">=</span><span class="va">t</span>, state<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">DO.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    metab.pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="fl">2</span>, ER.daily<span class="op">=</span><span class="op">-</span><span class="fl">1.4</span>, K600.daily<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">dDOdt</span></span></span>
<span class="r-in"><span> <span class="va">DO.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">DO.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="va">dDOdt.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DOtime</span>, y<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DOtime</span>, y<span class="op">=</span><span class="va">DO.mod.m</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'purple'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dDOtime</span>, y<span class="op">=</span><span class="va">dDOdt.obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dDOtime</span>, y<span class="op">=</span><span class="va">dDOdt.mod.m</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute &amp; plot a full timeseries with ode() integration</span></span></span>
<span class="r-in"><span><span class="va">dDOdt</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'euler'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DO.mod.o</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="fl">2</span>, ER.daily<span class="op">=</span><span class="op">-</span><span class="fl">1.4</span>, K600.daily<span class="op">=</span><span class="fl">21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  times<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, func<span class="op">=</span><span class="va">dDOdt</span>, method<span class="op">=</span><span class="st">'euler'</span><span class="op">)</span><span class="op">[</span>,<span class="st">'DO.mod'</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DOtime</span>, y<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DOtime</span>, y<span class="op">=</span><span class="va">DO.mod.m</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'purple'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">DOtime</span>, y<span class="op">=</span><span class="va">DO.mod.o</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'red'</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.mod.o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">DO.mod.o</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dDOtime</span>, y<span class="op">=</span><span class="va">dDOdt.obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dDOtime</span>, y<span class="op">=</span><span class="va">dDOdt.mod.m</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dDOtime</span>, y<span class="op">=</span><span class="va">dDOdt.mod.o</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'green'</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># see how values of metab.pars affect the dDOdt predictions</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dDOdt</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'euler'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">apply_dDOdt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">GPP.daily</span>, <span class="va">ER.daily</span>, <span class="va">K600.daily</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">DO.mod.m</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">dDOdt.mod.m</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">dDOdt.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">dDOdt</span><span class="op">(</span>t<span class="op">=</span><span class="va">t</span>, state<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">DO.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="va">GPP.daily</span>, ER.daily<span class="op">=</span><span class="va">ER.daily</span>, K600.daily<span class="op">=</span><span class="va">K600.daily</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">dDOdt</span></span></span>
<span class="r-in"><span>   <span class="va">DO.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">DO.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="va">dDOdt.mod.m</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">dDOdt.mod.m</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">dDO.preds</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  solar.time <span class="op">=</span> <span class="va">dDOtime</span>,</span></span>
<span class="r-in"><span>  dDO.preds.base <span class="op">=</span> <span class="fu">apply_dDOdt</span><span class="op">(</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  dDO.preds.dblGPP <span class="op">=</span> <span class="fu">apply_dDOdt</span><span class="op">(</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  dDO.preds.dblER <span class="op">=</span> <span class="fu">apply_dDOdt</span><span class="op">(</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  dDO.preds.dblK <span class="op">=</span> <span class="fu">apply_dDOdt</span><span class="op">(</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dDO.preds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">dDO.series</span>, value<span class="op">=</span><span class="va">dDO.dt</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'dDO.preds'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">dDO.dt</span>, color<span class="op">=</span><span class="va">dDO.series</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># try simulating process eror</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'30'</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">48</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.noerr</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'rk4'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span>, err.proc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DO.mod.noerr</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="fl">2</span>, ER.daily<span class="op">=</span><span class="op">-</span><span class="fl">1.4</span>, K600.daily<span class="op">=</span><span class="fl">21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  times<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, func<span class="op">=</span><span class="va">dDOdt.noerr</span>, method<span class="op">=</span><span class="st">'rk4'</span><span class="op">)</span><span class="op">[</span>,<span class="st">'DO.mod'</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">DO.mod.noerr</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'purple'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># with error</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.err</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'rk4'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span>, err.proc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">+</span><span class="fl">0.4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DO.mod.err</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="fl">2</span>, ER.daily<span class="op">=</span><span class="op">-</span><span class="fl">1.4</span>, K600.daily<span class="op">=</span><span class="fl">21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  times<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, func<span class="op">=</span><span class="va">dDOdt.err</span>, method<span class="op">=</span><span class="st">'rk4'</span><span class="op">)</span><span class="op">[</span>,<span class="st">'DO.mod'</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">DO.mod.err</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'red'</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># with same error each timestep is same as with reduced ER</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.noerr2</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'rk4'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span>, err.proc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DO.mod.noerr2</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="fl">2</span>, ER.daily<span class="op">=</span><span class="op">-</span><span class="fl">1.4</span><span class="op">+</span><span class="fl">0.4</span>, K600.daily<span class="op">=</span><span class="fl">21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  times<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, func<span class="op">=</span><span class="va">dDOdt.noerr2</span>, method<span class="op">=</span><span class="st">'rk4'</span><span class="op">)</span><span class="op">[</span>,<span class="st">'DO.mod'</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">DO.mod.noerr2</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'green'</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># with different timestep, same error value should mean very similar curve</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'30'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dDOdt.err2</span> <span class="op">&lt;-</span> <span class="fu">create_calc_dDOdt</span><span class="op">(</span><span class="va">data</span>, ode_method<span class="op">=</span><span class="st">'rk4'</span>, GPP_fun<span class="op">=</span><span class="st">'linlight'</span>,</span></span>
<span class="r-in"><span>  ER_fun<span class="op">=</span><span class="st">'constant'</span>, deficit_src<span class="op">=</span><span class="st">'DO_mod'</span>, err.proc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DO.mod.err2</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DO.mod<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">DO.obs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GPP.daily<span class="op">=</span><span class="fl">2</span>, ER.daily<span class="op">=</span><span class="op">-</span><span class="fl">1.4</span>, K600.daily<span class="op">=</span><span class="fl">21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  times<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, func<span class="op">=</span><span class="va">dDOdt.err2</span>, method<span class="op">=</span><span class="st">'rk4'</span><span class="op">)</span><span class="op">[</span>,<span class="st">'DO.mod'</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">DO.mod.err2</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'black'</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Alison P. Appling, Robert O. Hall, Maite Arroita, Charles B. Yackulic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

