<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="streamMetabolizer">
<title>Data Preparation • streamMetabolizer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Preparation">
<meta property="og:description" content="streamMetabolizer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">streamMetabolizer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_prep.html">Data Preparation</a>
    <a class="dropdown-item" href="../articles/get_started.html">Quickstart</a>
    <a class="dropdown-item" href="../articles/gpp_er_eqs.html">GPP and ER Equations</a>
    <a class="dropdown-item" href="../articles/installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/model_structures.html">Model Structures</a>
    <a class="dropdown-item" href="../articles/models_bayes.html">Bayesian Models</a>
    <a class="dropdown-item" href="../articles/models_mle.html">MLE Models</a>
    <a class="dropdown-item" href="../articles/ode_methods.html">ODE Methods</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USGS-R/streamMetabolizer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Data Preparation</h1>
                        <h4 data-toc-skip class="author">Alison Appling
and Bob Hall</h4>
            
            <h4 data-toc-skip class="date">2023-07-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/streamMetabolizer/blob/HEAD/vignettes/data_prep.Rmd" class="external-link"><code>vignettes/data_prep.Rmd</code></a></small>
      <div class="d-none name"><code>data_prep.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<p>A properly formatted input dataset for streamMetabolizer models
has:</p>
<ul>
<li>exactly the right data columns and column names. Call
<code><a href="../reference/metab_inputs.html">metab_inputs()</a></code> to see the requirements for a specific model
type.</li>
<li>data in the right units. See <code><a href="../reference/mm_data.html">?mm_data</a></code> for definitions
of each column.</li>
</ul>
<p>An input dataset may optionally include:</p>
<ul>
<li>partial days; partial days will be automatically excluded, so you
don’t need to do this yourself.</li>
<li>non-continuous days; no current streamMetabolizer models require
continuous days.</li>
</ul>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>An example of a properly formatted input dataset is available in the
streamMetabolizer package - data are from French Creek in Laramie, WY,
courtesy of Bob Hall.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USGS-R/streamMetabolizer" class="external-link">streamMetabolizer</a></span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_metab.html">data_metab</a></span><span class="op">(</span>num_days<span class="op">=</span><span class="st">'3'</span>, res<span class="op">=</span><span class="st">'15'</span><span class="op">)</span></span></code></pre></div>
<p>Inspect the dimensions and column names of the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 288   6</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">48</span>,<span class="fl">96</span>,<span class="fl">240</span>,<span class="fl">288</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># some example rows</span></span></code></pre></div>
<pre><code><span><span class="co">##               solar.time DO.obs   DO.sat depth temp.water    light</span></span>
<span><span class="co">## 5689 2012-09-18 04:05:58   8.41 9.083329  0.16       3.60   0.0000</span></span>
<span><span class="co">## 5830 2012-09-18 15:50:58   8.36 7.403370  0.16      11.80 925.1370</span></span>
<span><span class="co">## 5974 2012-09-19 03:50:58   8.17 8.927566  0.16       4.25   0.0000</span></span>
<span><span class="co">## 6404 2012-09-20 15:50:58   8.35 7.358846  0.16      12.06 898.9231</span></span>
<span><span class="co">## 6548 2012-09-21 03:50:58   8.21 8.854844  0.16       4.56   0.0000</span></span></code></pre>
<p>You can get additional information about the expected format of the
data in the <code><a href="../reference/metab.html">?metab</a></code> help document. When preparing your own
data, make sure the class and units of your data match those specified
in that document.</p>
</div>
<div class="section level2">
<h2 id="exploring-input-data">Exploring input data<a class="anchor" aria-label="anchor" href="#exploring-input-data"></a>
</h2>
<p>You can use other common R packages to graphically inspect the input
data. Look for outliers and oddities to ensure the quality of your
data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>DO.pctsat <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">DO.obs</span> <span class="op">/</span> <span class="va">DO.sat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">solar.time</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'DO'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">DO.value</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'DO'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>units<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">'DO.pctsat'</span>, <span class="st">'DO\n(% sat)'</span>, <span class="st">'DO\n(mg/L)'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">DO.value</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">units</span> <span class="op">~</span> <span class="va">.</span>, scale<span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="st">'variable'</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_prep_files/figure-html/viz_inputs_DO-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>depth<span class="op">=</span><span class="st">'depth\n(m)'</span>, temp.water<span class="op">=</span><span class="st">'water temp\n(deg C)'</span>, light<span class="op">=</span><span class="st">'PAR\n(umol m^-2 s^-1)'</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">solar.time</span>, <span class="va">depth</span>, <span class="va">temp.water</span>, <span class="va">light</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">value</span>, <span class="va">depth</span>, <span class="va">temp.water</span>, <span class="va">light</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">type</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'depth'</span>,<span class="st">'temp.water'</span>,<span class="st">'light'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    units<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">labels</span><span class="op">[</span><span class="va">type</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">units</span> <span class="op">~</span> <span class="va">.</span>, scale<span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="st">'variable'</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_prep_files/figure-html/viz_inputs_other-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="check-the-input-data-format">Check the input data format<a class="anchor" aria-label="anchor" href="#check-the-input-data-format"></a>
</h2>
<p>Your data need to have specific column names and units. To see what
is required, use the <code>metab_inputs</code> function to get a
description of the required inputs for a given model type. The output of
metab_inputs is a table describing the required column names, the
classes and units of the values in each column, and whether that column
is required or optional. The inputs are identical for the model types
‘mle’, ‘bayes’, and ‘night’, so here we’ll just print the requriements
for ‘mle’.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/metab_inputs.html">metab_inputs</a></span><span class="op">(</span><span class="st">'mle'</span>, <span class="st">'data'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      colname          class          units     need</span></span>
<span><span class="co">## 1 solar.time POSIXct,POSIXt                required</span></span>
<span><span class="co">## 2     DO.obs        numeric      mgO2 L^-1 required</span></span>
<span><span class="co">## 3     DO.sat        numeric      mgO2 L^-1 required</span></span>
<span><span class="co">## 4      depth        numeric              m required</span></span>
<span><span class="co">## 5 temp.water        numeric           degC required</span></span>
<span><span class="co">## 6      light        numeric umol m^-2 s^-1 required</span></span>
<span><span class="co">## 7  discharge        numeric       m^3 s^-1 optional</span></span></code></pre>
<p>Also read through the help pages at <code><a href="../reference/metab.html">?metab</a></code> and
<code><a href="../reference/mm_data.html">?mm_data</a></code> for more detailed variable definitions and
requirements.</p>
</div>
<div class="section level2">
<h2 id="prepare-the-timestamps">Prepare the timestamps<a class="anchor" aria-label="anchor" href="#prepare-the-timestamps"></a>
</h2>
<p>To prepare your timestamps for metabolism modeling, you need to
convert from the initial number or text format into POSIXct with the
correct timezone (tz), then to solar mean time.</p>
<div class="section level3">
<h3 id="step-1-posixct">Step 1: POSIXct<a class="anchor" aria-label="anchor" href="#step-1-posixct"></a>
</h3>
<p>Convert your logger-format data to POSIXct in a local timezone (with
or without daylight savings, as long as you have that timezone scheme
specified). Here are a few examples of specific scenarios and
solutions.</p>
<div class="section level4">
<h4 id="starting-with-numeric-datetimes-e-g--from-pmes">Starting with numeric datetimes, e.g., from PMEs<a class="anchor" aria-label="anchor" href="#starting-with-numeric-datetimes-e-g--from-pmes"></a>
</h4>
<p>If you have datetimes stored in seconds since 1/1/1970 at Greenwich
(i.e., in UTC):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num.time</span> <span class="op">&lt;-</span> <span class="fl">1471867200</span></span>
<span><span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">num.time</span>, origin<span class="op">=</span><span class="st">'1970-01-01'</span>, tz<span class="op">=</span><span class="st">'UTC'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 UTC"</span></span></code></pre>
<p>If you have datetimes stored in seconds since 1/1/1970 at Laramie, WY
(i.e., in MST, no daylight savings):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num.time</span> <span class="op">&lt;-</span> <span class="fl">1471867200</span></span>
<span><span class="op">(</span><span class="va">posix.time.nominalUTC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">num.time</span>, origin<span class="op">=</span><span class="st">'1970-01-01'</span>, tz<span class="op">=</span><span class="st">'UTC'</span><span class="op">)</span><span class="op">)</span> <span class="co"># the numbers get treated as UTC no matter what tz you request</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 UTC"</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/force_tz.html" class="external-link">force_tz</a></span><span class="op">(</span><span class="va">posix.time.nominalUTC</span>, <span class="st">'Etc/GMT+7'</span><span class="op">)</span><span class="op">)</span> <span class="co"># +7 = mountain standard time</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 -07"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="starting-with-text-timestamps">Starting with text timestamps<a class="anchor" aria-label="anchor" href="#starting-with-text-timestamps"></a>
</h4>
<p>If you have datetimes stored as text timestamps in UTC, you can
bypass the conversion to local time and just start with UTC. Then rather
than using <code><a href="../reference/calc_solar_time.html">calc_solar_time()</a></code> in Step 2, you’ll use
<code><a href="../reference/convert_UTC_to_solartime.html">convert_UTC_to_solartime()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="st">'2016-08-22 12:00:00'</span></span>
<span><span class="op">(</span><span class="va">posix.time.utc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, tz<span class="op">=</span><span class="st">'UTC'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 UTC"</span></span></code></pre>
<p>If you have datetimes stored as text timestamps in EST/EDT (with
daylight savings):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="st">'2016-08-22 12:00:00'</span></span>
<span><span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d %H:%M:%S"</span>, tz<span class="op">=</span><span class="st">'America/New_York'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 EDT"</span></span></code></pre>
<p>If you have datetimes stored as text timestamps in EST (no daylight
savings):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="st">'2016-08-22 12:00:00'</span></span>
<span><span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d %H:%M:%S"</span>, tz<span class="op">=</span><span class="st">'Etc/GMT+5'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 -05"</span></span></code></pre>
<p>See <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="external-link uri">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a>
for a list of timezone names.</p>
</div>
<div class="section level4">
<h4 id="starting-with-chron-datetimes">Starting with <code>chron</code> datetimes<a class="anchor" aria-label="anchor" href="#starting-with-chron-datetimes"></a>
</h4>
<p>If you have datetimes stored in the <code>chron</code> time format in
EST (no daylight savings):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chron.time</span> <span class="op">&lt;-</span> <span class="fu">chron</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chron/man/chron.html" class="external-link">chron</a></span><span class="op">(</span><span class="st">'08/22/16'</span>, <span class="st">'12:00:00'</span><span class="op">)</span></span>
<span><span class="va">time.format</span> <span class="op">&lt;-</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span></span>
<span><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">chron.time</span>, <span class="va">time.format</span><span class="op">)</span> <span class="co"># direct as.POSIXct time works poorly</span></span>
<span><span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, format<span class="op">=</span><span class="va">time.format</span>, tz<span class="op">=</span><span class="st">'Etc/GMT+5'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 12:00:00 -05"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="step-2-solar-time">Step 2: Solar time<a class="anchor" aria-label="anchor" href="#step-2-solar-time"></a>
</h3>
<p>Now convert from local time to solar time. In
<code>streamMetabolizer</code> vocabulary, <code>solar.time</code>
specifically means mean solar time, the kind where every day is exactly
24 hours, in contrast to apparent solar time. You’re ready for this step
when you have the correct time in a local timezone and
<code>lubridate::tz(yourtime)</code> reflects the correct timezone.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/tz.html" class="external-link">tz</a></span><span class="op">(</span><span class="va">posix.time.localtz</span><span class="op">)</span> <span class="co"># yep, we want and have the code for EST</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Etc/GMT+5"</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">posix.time.solar</span> <span class="op">&lt;-</span> <span class="fu">streamMetabolizer</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_solar_time.html">calc_solar_time</a></span><span class="op">(</span><span class="va">posix.time.localtz</span>, longitude<span class="op">=</span><span class="op">-</span><span class="fl">106.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-08-22 09:55:58 UTC"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="other-data-preparation">Other data preparation<a class="anchor" aria-label="anchor" href="#other-data-preparation"></a>
</h2>
<p>streamMetabolizer offers many functions to help you prepare your data
for modeling. We recommend that you explore the help pages for the
following functions:</p>
<ul>
<li><code>calc_depth</code></li>
<li><code>calc_DO_sat</code></li>
<li><code>calc_light</code></li>
<li><code>convert_date_to_doyhr</code></li>
<li><code>convert_localtime_to_UTC</code></li>
<li><code>convert_UTC_to_solartime</code></li>
<li><code>convert_k600_to_kGAS</code></li>
<li><code>convert_PAR_to_SW</code></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alison P. Appling, Robert O. Hall, Maite Arroita, Charles B. Yackulic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
